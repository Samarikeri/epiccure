#include <WiFi.h>
#include <HTTPClient.h>

// ----------------------------
// CONFIGURE THESE
// ----------------------------
const char* ssid     = "YOUR_WIFI_NAME";
const char* password = "YOUR_WIFI_PASSWORD";

String BOT_TOKEN = "YOUR_TELEGRAM_BOT_TOKEN";
String CHAT_ID   = "YOUR_CHAT_ID";

// ----------------------------
// Serial/UART settings
// ----------------------------
HardwareSerial STM(2);     // UART2 (GPIO17 RX, GPIO16 TX)

// ----------------------------
// Send message to Telegram
// ----------------------------
void sendToTelegram(String message)
{
    message.trim();
    if (message.length() == 0) return;  // ignore empty messages

    String url = 
        "https://api.telegram.org/bot" + BOT_TOKEN +
        "/sendMessage?chat_id=" + CHAT_ID +
        "&text=" + message;

    HTTPClient http;
    http.begin(url);

    int httpCode = http.GET();  
    http.end();
}

// ----------------------------
// WiFi connect
// ----------------------------
void connectWiFi()
{
    WiFi.begin(ssid, password);
    while (WiFi.status() != WL_CONNECTED) {
        delay(300);
    }
}

// ----------------------------
// SETUP
// ----------------------------
void setup()
{
    Serial.begin(115200);
    STM.begin(115200, SERIAL_8N1, 17, 16);   // RX=17, TX=16

    connectWiFi();
}

// ----------------------------
// MAIN LOOP
// ----------------------------
void loop()
{
    if (STM.available()) 
    {
        String msg = STM.readStringUntil('\n');
        msg.trim();
        
        if (msg.length() > 0) {
            sendToTelegram(msg);
        }
    }
}
